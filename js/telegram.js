/** * Cosmic Miner — Telegram Web App Integration */ const TG = { app: null, user: null, startParam: null, init() { if (window.Telegram && window.Telegram.WebApp) { this.app = window.Telegram.WebApp; this.app.ready(); this.app.expand(); if (this.app.initDataUnsafe) { this.user = this.app.initDataUnsafe.user || null; this.startParam = this.app.initDataUnsafe.start_param || null; } console.log('[TG] Telegram WebApp initialized'); } else { console.log('[TG] Running outside Telegram (dev mode)'); } }, hapticImpact(style = 'light') { try { if (this.app && this.app.HapticFeedback) { this.app.HapticFeedback.impactOccurred(style); } } catch (e) { } }, hapticNotification(type = 'success') { try { if (this.app && this.app.HapticFeedback) { this.app.HapticFeedback.notificationOccurred(type); } } catch (e) { } }, openInvoice(invoiceUrl) { if (this.app && this.app.openInvoice) { return new Promise((resolve) => { this.app.openInvoice(invoiceUrl, (status) => { resolve(status); }); }); } return Promise.resolve('failed'); }, shareInvite(botUsername) { const userId = this.user ? this.user.id : '0'; const link = `https://t.me/${botUsername}?start=ref_${userId}`; const text = '⛏️ Cosmic Miner — тапай астероид, добывай кристаллы! Играй бесплатно:'; if (this.app && this.app.openTelegramLink) { this.app.openTelegramLink( `https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}` ); } else { navigator.clipboard.writeText(`${text}\n${link}`).catch(() => { }); } }, getUserId() { return this.user ? this.user.id : `local_${Date.now()}`; }, getStartParam() { return this.startParam; } }; TG.init();
